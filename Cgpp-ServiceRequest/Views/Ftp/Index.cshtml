
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}



<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <h4 class="card-title d-flex justify-content-between mx-2">
                    Ftp Credentials
                    <button class="btn btn-sm btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#addftpModal">
                        <i class="fas fa-solid fa-plus fa-sm text-white-50"></i> Add Ftp
                    </button>
                </h4>
                <h6 class="card-subtitle"></h6>
                <div class="table-responsive">
                    <table id="ftpTables" class="table table-condensed display">
                        <thead>
                            <tr>
                                <th>Date Added</th>
                                <th>Label</th>
                                <th>Host</th>
                                <th>User Name</th>
                                <th>Port</th>
                                <th>Folder</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="addftpModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-m modal-notify modal-info" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <p class="heading" id="exampleModalLabel"><h4 class="card-title d-flex justify-content-between">Update Ftp</h4></p>
            </div>
            <div class="modal-body">
                <form id="saveftp">
                    <div class="row">
                        <div class="form-group">
                            <label for="">Label</label>
                            <input type="text" class="form-control mt-3 mb-3" name="label" id="label" required />
                        </div>
                        <div class="form-group">
                            <label for="">Folder Name</label>
                            <input type="text" class="form-control mt-3 mb-3" name="folderName" id="folderName" required />
                        </div>
                        <div class="form-group">
                            <label for="">Host</label>
                            <input type="text" class="form-control mt-3 mb-3" name="ftpHost" id="ftpHost" required />
                        </div>
                        <div class="form-group">
                            <label for="">Username</label>
                            <input type="text" class="form-control mt-3 mb-3" name="ftpUsername" id="ftpUsername" required />
                        </div>
                        <div class="form-group">
                            <label for="">Port</label>
                            <input type="text" class="form-control mt-3 mb-3" name="ftpPort" id="ftpPort" required />
                        </div>
                        <div class="form-group">
                            <label for="">Password</label>
                            <input type="text" class="form-control mt-3 mb-3" name="ftpPassword" id="name" required />
                        </div>
                    </div>
                    <input type="hidden" id="id" name="id" />
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" value=" submit" class="btn btn-success " id="btnSubmit">Submit</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="editftpModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-m modal-notify modal-info" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <p class="heading" id="exampleModalLabel"><h4 class="card-title d-flex justify-content-between">Department</h4></p>
            </div>
            <div class="modal-body">
                <form id="editftp">
                    <div class="row">
                        <div class="form-group">
                            <label for="">Label</label>
                            <input type="text" class="form-control mt-3 mb-3" name="label" id="label" required />
                        </div>
                        <div class="form-group">
                            <label for="">Folder Name</label>
                            <input type="text" class="form-control mt-3 mb-3" name="folderName" id="folderName" required />
                        </div>
                        <div class="form-group">
                            <label for="">Host</label>
                            <input type="text" class="form-control mt-3 mb-3" name="ftpHost" id="ftpHost" required />
                        </div>
                        <div class="form-group">
                            <label for="">Username</label>
                            <input type="text" class="form-control mt-3 mb-3" name="ftpUsername" id="ftpUsername" required />
                        </div>
                        <div class="form-group">
                            <label for="">Port</label>
                            <input type="text" class="form-control mt-3 mb-3" name="ftpPort" id="ftpPort" required />
                        </div>
                        <div class="form-group">
                            <label for="">Password</label>
                            <input type="text" class="form-control mt-3 mb-3" name="ftpPassword" placeholder="ftpPassword" id="name" required />
                        </div>

                    </div>
                    <input type="hidden" id="id" name="id" />
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" value=" submit" class="btn btn-success " id="UpdateRecord">Save</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" data-bs-backdrop="static" data-bs-keyboard="false" id="deleteModal">
    <div class="modal-dialog modal-m modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="card-title d-flex justify-content-between modal-title" style="padding:0;">Delete Ftp</h4>
                <a href="#" class="close" data-bs-dismiss="modal">&times;</a>
            </div>
            <div class="modal-body">
                <h6 class="card-subtitle">Are you sure you want to Remove this Ftp?</h6>
            </div>
            <div class="modal-footer">
                <input type="hidden" name="id" id="id" />
                <a href="#" class="btn-success btn-sm" id="btnDelete">Confirm</a>
                <a href="#" class="btn-danger btn-sm" data-bs-dismiss="modal">Cancel</a>
            </div>
        </div>
    </div>
</div>

@section scripts
{
    <script>

        $(document).ready(function () {
            var Datatables;
            Datatables = $("#ftpTables").DataTable({
                ajax: {
                    url: "/api/ftp/get",
                    dataSrc: "",
                    headers: {
                        "Authorization": "Bearer " + localStorage.getItem('access_token')
                    }
                },
                autoWidth: false,
                columns: [

                    {
                        data: "dateAdded",
                    },

                    {
                        data: "label",
                    },
                    {
                        data: "ftpHost",
                    },
                    {
                        data: "ftpUsername",
                    },
                    {
                        data: "ftpPort",
                    },
                    {
                        data: "folderName",
                    },
                    {
                        data: null,
                        render: function (data) {
                            return '<button class="btn btn-outline-success edit" data-id="' + data.id + '"><i class="fas fa-edit"></i> Edit</button>'
                                + '  <button class="btn btn-outline-danger delete" data-id="' + data.id + '"><i class="fas fa-trash"></i> Delete</button>'
                        },
                        "orderable": false,
                    }

                ]
            });

            $("#ftpTables").on('click', '.edit', function () {
                var id = $(this).attr('data-id');
                var url = '/api/ftp/getbyId/' + id;
                //alert(id);
                $.ajax({
                    type: 'GET',
                    url: url,
                    success: function (data) {
                        $("#editftpModal").modal('show');
                        $('#editftp').find('input[name="id"]').val(data.id);
                        $('#editftp').find('input[name="ftpHost"]').val(data.ftpHost);
                        $('#editftp').find('input[name="ftpPort"]').val(data.ftpPort);
                        $('#editftp').find('input[name="ftpUsername"]').val(data.ftpUsername);
                        $('#editftp').find('input[name="ftpPassword"]').val(data.ftpPassword);
                        $('#editftp').find('input[name="label"]').val(data.label);
                        $('#editftp').find('input[name="folderName"]').val(data.folderName);

                    },
                    //if failed
                    error: function (data) {
                        // console.log(data, data.id, data.name);
                        toastr.error("error")
                    }
                })
            });




            $('#btnSubmit').click(function (e) {
                e.preventDefault();

                //find name
                var ftpHost = $('input[name=ftpHost]').val();
                var ftpPort = $('input[name=ftpPort]').val();
                var ftpUsername = $('input[name=ftpUsername]').val();
                var ftpPassword = $('input[name=ftpPassword]').val();
                var label = $('input[name=label]').val();
                var folderName = $('input[name=folderName]').val();

                // data
                var data = {
                    ftpHost: ftpHost,
                    ftpPort: ftpPort,
                    ftpUsername: ftpUsername,
                    ftpPassword: ftpPassword,
                    label: label,
                    folderName: folderName
                };
                $.ajax({
                    type: 'POST',
                    url: '/api/ftp/post',
                    data: data,
                    headers: {
                        'Authorization': 'Bearer ' + localStorage.getItem('access_token')
                    },
                    success: function (data) {
                        console.log(data);
                      //$("#name").val("");

                        $('#addftpModal').modal('hide');
                        //show please wait modal
                        $('#pleasewait').modal('show');
                        //show toastr after 3
                        setTimeout(function () {
                            toastr.success("Ftp Successfully Added!");
                            // hide please wait modal
                        }, 2000);
                        setTimeout(function () {
                            window.location.reload();
                        }, 3000);
                    },
                    //if failed
                    error: function (data) {
                        toastr.error("Host Already Exist In the Database/ Invalid")
                    }
                });
            });


            $("#UpdateRecord").click(function (e) {
                e.preventDefault();
                var data = {
                     ftpHost: $('#editftp').find('input[name=ftpHost]').val(),
                     ftpPort: $('#editftp').find('input[name=ftpPort]').val(),
                     ftpUsername: $('#editftp').find('input[name=ftpUsername]').val(),
                     ftpPassword: $('#editftp').find('input[name=ftpPassword]').val(),
                     label: $('#editftp').find('input[name=label]').val(),
                     folderName: $('#editftp').find('input[name=folderName]').val()
                };
                var id = $('#editftp').find('input[name="id"]').val();
                $.ajax({
                    type: 'PUT',
                    url: '/api/ftp/update/' + id,
                    data: data,
                    headers: {
                        'Authorization': 'Bearer ' + localStorage.getItem('access_token')
                    },
                    success: function (data) {
                        console.log(data);
                        $('#editftpModal').modal('hide');
                        //show please wait modal
                        $('#pleasewait').modal('show');
                        //show toastr after 3
                        setTimeout(function () {
                            toastr.success("Data Successfully Updated!");
                            // hide please wait modal
                        }, 2000);
                        setTimeout(function () {
                            window.location.reload();
                        }, 3000);
                    },
                    //if failed
                    error: function (data) {
                        toastr.error("Error Saving")
                    }
                });
            });

            $('#ftpTables').on('click', '.delete', function () {
                var id = $(this).attr('data-id');
                var url = '/api/ftp/Remove/' + id;
                $.ajax({
                    // confirm before delete
                    beforeSend: function (xhr) {
                        // use bootbox
                        bootbox.confirm({
                            message: "Are you sure you want to delete this record?",
                            buttons: {
                                // yes and no sequence
                                confirm: {
                                    label: 'Yes',
                                    className: 'btn-success btn-sm'
                                },
                                cancel: {
                                    label: 'No',
                                    className: 'btn-danger btn-sm'
                                }
                            },
                            callback: function (result) {
                                if (result) {
                                    $.ajax({
                                        type: 'DELETE',
                                        url: url,
                                        headers: {
                                            'Authorization': 'Bearer ' + localStorage.getItem('access_token')
                                        },
                                        success: function (data) {
                                            ////show please wait modal
                                            //$('#pleasewait').modal('show');
                                            ////show toastr after 3
                                            //setTimeout(function () {
                                            //    toastr.success("Department Successfully Deleted!");
                                            //}, 2000);
                                            //setTimeout(function () {
                                            //    window.location.reload();
                                            //}, 3000);
                                        },
                                        //if failed
                                        error: function (data) {
                                            toastr.error("Error Deleting Data")
                                        }
                                    });
                                }
                            }
                        });

                    },
                });
            });
        });
    </script>
}

